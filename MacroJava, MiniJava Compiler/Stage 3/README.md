## Stage 3: MiniJava to microIR

We start with type checked MiniJava programs and generate programs in MircoIR format. Akin to a standard optimizing compiler, in this stage, we will implement a module that translates programs in a high level language (minijava) to programs in intermediate form (microIR).

To generate microIR code for `A.java` file, run the following commands:

```bash
javac A3.java

java A3 < A.java > A.microIR
```

To ensure that your MicroIR program is semantically equivalent to the A.java program, one can use the interpreter of MicroIR [(download link)](https://drive.google.com/file/d/1BnKOyQoEMwQ_0DpvWgGi1GJUdDwHBsjx/view) to compare the output of A.java with the output of the microIR program generated by the compiler. Say the generated microIR code is stored in A.microIR, then to invoke the interpreter use: java -jar pgi.jar < A.microIR.

**microIR SPECIFICATION**

microIR is an intermediate representation for Minijava. It has simplified expressions, exposes the runtime model (integer is of size 4, field and method references require accessing of the address of the object, "new" operator is replaced with system call HALLOCATE).

**procedures:**

    If we have a procedure

    ProcLabel [5] Stmt

    then it takes five arguments, called (temp 0), (temp 1), ..., (temp 4). Other temporaries can be used without declaration and treated as locals. It executes the statement Stmt.

**arrays:**

    The index of an array is a multiple of 4, starting at 0.

**NOOP:**

    Does nothing.

**ERROR:**

    Terminates the program execution with an error message.

**CJUMP Temp Label:**

    If Temp evaluates to 1, then continue with the next statement, otherwise jump to Label.

**HSTORE Temp_1 IntegerLiteral Temp_2:**

    Temp_1 evaluates to an address

    IntegerLiteral is an offset

    Temp_2 evaluates to the value that should be stored.

**HLOAD Temp_1 Temp_2 IntegerLiteral:**

    Temp_1 is the temporary into which a value should be loaded

    Temp_2 evaluates to an address

    IntegerLiteral is an offset.

**NE: is "!="**

**LE: is "<="**

**HALLOCATE SimpleExp:**

    SimpleExp evaluates to an integer, and that corresponding amount of heapspace is allocated, and the return address of that is returned as the result.